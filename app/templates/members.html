{% extends "sidebar.html" %} {% block div %}

{% if session.get('TYPE') == "Organizer" %}

  <div>
    <div class="page_header">
      <h2 class="dash_header mb-5">{{ fullSet[0]['set_name'] }}</h2>
      {% include 'flash_messages.html' %}
    </div>
  </div>
      {% if not getMembers %}
      <div class = "alert alert-primary mt-5">
              No one has joined the Set.
          </div>
      {% endif %}

    <!-- <h4 class="grp_header">Members:</h4> -->
    {% if session.get('TYPE') == "Organizer" and getMembers %}
    <div class="row mb-3">
            
      <div class="col">
        <h4 class="grp_header">Members: </h4>
      </div>
        
      <div class="col btn-align">
        <!-- Button trigger modal -->
        <button class="btn btn-outline-success my-2 my-sm-0" data-toggle="modal" data-target="#formgroupmodal">
          Form Groups
        </button>
      </div>
    </div>
    
      <span class="btn-right">
        </span>

    {% endif %}

    <div class="row">
      {% if session.get('TYPE') == "Organizer" and getMembers %} {% for item in
      getMembers %}
      <div class="col-4 mb-4">
        <button class="member-tile">
          <div class="py-3">
            {{ item['first_name'] }} {{ item['last_name'] }}
          </div>
        </button>
      </div>
      {% endfor %} 
      {% endif %} 
    </div>
  <div class="modal fade" id="formgroupmodal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="PopUpTitle">Form Groups</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <form
          action="{{ url_for('members', sid = sid) }}"
          method="post"
          >

          {{ form.csrf_token }}

          <div class="dropdown">

            <h5 class="modal-title mb-2" id="PopUpTitle">Group By:</h5> 
            {{ form.grpBy(class='btn btn-outline-success my-2 my-sm-0 dropdown-toggle mb-3') }}

          </div>
          
          <div class="dropdown">

            <h5 class="modal-title mb-2 mt-4" id="PopUpTitle">Number of Persons:</h5>  
            {{ form.numPersons(class='btn btn-outline-success my-2 my-sm-0 dropdown-toggle mb-3') }}

          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          
            {{ form.submit(class='btn btn-outline-success my-2 my-sm-0') }}
        
          </form>

        </div>
      </div>
    </div>
  </div>
{% endif %}


{% if session.get('TYPE') == "Regular" %}
  <div>
    <div class="page_header">
      <h2 class="dash_header mb-5">{{set_name['set_name']}}</h2>
      <!-- {% include 'flash_messages.html' %} -->
    </div>
  </div>

  

  {% if grp_num %}
    <h2 class="basic-heading mb-5"">Group {{grp_num}}</h2>
    <button
          id="getmems"
          data-id="{{ cur_set.csi }} {{ cur_set.percentage }} {{
            cur_set.personality_score }} {{ cur_set.leadership_score }} {{
            cur_set.hobby_score }} {{ cur_set.gender_score }} {{ cur_set.age_score }} {{
            cur_set.height_score }} {{ cur_set.ethnicity_score }} {{
            cur_set.education_score }} {{ cur_set.occupation_score }} {{cur_set.amount}}"
          id="getuser"
          class="btn recom"
          onclick="document.getElementById('getmems').style.display ='none';"
        >
          View More Details
        </button>
    <br>
    <span class="" id="PercentageHolder"></span>
<span class="ml-5" id="CSIHolder"></span>
<span class="ml-5" id="MaxHolder"></span>
<br>

    <div class="row">
    {% for member in getMembers %}
    <div class="col-4 mb-4">
      <button class="member-tile">
        <div class="py-3">
          {{ member['first_name'] }} {{ member['last_name'] }} 
        </div>
      </button>
    </div>
    {% endfor %} 
    <canvas id="myChart" width="800" height="350" class="mb-4"></canvas>
  </div>

  {% else %}
      <div class = "alert alert-primary mt-5">
            No groups have been formed yet.
      </div>
  {% endif %}

{% endif %}

<script>
  $(document).on("click", "#getmems", function () {
      var id = $(this).attr("data-id"); //data-id of button
      var array = id.split(" ");

      divide_by = parseInt(array[11])
      if (divide_by >= 2) {
        divide_by = divide_by + 1
      }

      cscore = parseFloat((array[0])/divide_by).toFixed(1);
      perc = parseFloat((array[1])/divide_by).toFixed(1);

      $("#CSIHolder").html("CSI: " + cscore);
      $("#MaxHolder").html("Max: 9");
      $("#PercentageHolder").html("Compatibility: " + perc +  "%");
      

      var ctx = document.getElementById("myChart");

      //Global
      Chart.defaults.scale.gridLines.drawOnChartArea = false;

      let firstValues = [
        parseFloat(array[2])/divide_by * 100,
        parseFloat(array[3])/divide_by * 100,
        parseFloat(array[4])/divide_by * 100,
        parseFloat(array[5])/divide_by * 100,
        parseFloat(array[6])/divide_by * 100,
        parseFloat(array[7])/divide_by * 100,
        parseFloat(array[8])/divide_by * 100,
        parseFloat(array[9])/divide_by * 100,
        parseFloat(array[10])/divide_by * 100,
        parseFloat(array[11])/divide_by * 100,
      ];
      let firstlabels = [
        "Personality",
        "Leadership",
        "Hobby",
        "Sex",
        "Age",
        "Height",
        "Ethnicity",
        "Education",
        "Occupation",
      ];
      initial = {
        labels: firstlabels,
        datasets: [
          {
            label: "Scores",
            data: firstValues,
            backgroundColor: [
              "#4E77D2",
              "#7EA2F3",
              "#ABC5FE",
              "#D8E4FF",
              "#4E77D2",
              "#7EA2F3",
              "#ABC5FE",
              "#D8E4FF",
            ],
            borderColor: ["#4E77D2", "#7EA2F3", "#ABC5FE", "#D8E4FF"],
            borderWidth: 1,
            maxBarThickness: 16,
          },
        ],
      };

      var myChart = new Chart(ctx, {
        type: "horizontalBar",
        data: initial,
        options: {
          responsive: false,
          maintainAspectRatio: this.maintainAspectRatio,
          title: {
            display: true,
            text: "Stats",
            fontSize: 18,
          },
          legend: {
            display: false,
            labels: {
              // This more specific font property overrides the global property
              fontColor: "rgba(0, 0, 0, 0.8)",
              fontFamily: "Monserrat",
              fontsize: 16,
              fontColor: "red",
            },
          },
          tooltips: {
            enabled: false,
          },
          scales: {
            yAxes: [
              {
                ticks: {
                  beginAtZero: true,
                },
              },
            ],
            xAxes: [
              {
                stacked: true,
                scaleLabel: {
                  labelString: "Compatibility",
                  display: true,
                  fontSize: 16,
                },
              },
            ],
          },
        },
      });
    });
  </script>{% endblock %}
